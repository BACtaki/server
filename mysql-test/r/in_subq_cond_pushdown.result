create table t1 (a int, b int, c int, d int);
create table t2 (e int, f int, g int);
create table t3 (x int, y int);
insert into t1 values
(1,1,18,1), (2,1,25,1), (1,3,40,1), (2,1,15,4),
(4,2,24,4), (3,2,23,1), (1,2,40,2), (3,4,17,2),
(5,5,65,1), (2,3,70,3),  (1,4,35,3), (2,3,25,3);
insert into t2 values
(1,2,38), (2,3,15), (1,3,40), (1,4,35),
(2,2,70), (3,4,23), (5,5,12), (5,4,17),
(3,3,17), (4,2,24), (2,5,25), (5,1,65);
insert into t3 values
(1,25), (1,18), (2,15), (4,24),
(1,35), (3,23), (3,17), (2,15);
create view v1 as
(
select * from t3 where x<=3
);
# conjunctive subformula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where c<25 and
(a,c) in (select e,max(g) from t2 where e<5 group by e);
a	b	c	d
4	2	24	4
3	2	23	1
select * from t1
where c<25 and
(a,c) in (select e,max(g) from t2 where e<5 group by e);
a	b	c	d
4	2	24	4
3	2	23	1
explain select * from t1
where c<25 and
(a,c) in (select e,max(g) from t2 where e<5 group by e);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where c<25 and
(a,c) in (select e,max(g) from t2 where e<5 group by e);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.c < 25 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(g)` < 25",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted and formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where c>55 and b<4 and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
2	3	70	3
select * from t1
where c>55 and b<4 and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
2	3	70	3
explain select * from t1
where c>55 and b<4 and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where c>55 and b<4 and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.c > 55 and t1.b < 4 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(g)` > 55 and t2.f < 4",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where (c>60 or c<25) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
2	3	70	3
select * from t1
where (c>60 or c<25) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
2	3	70	3
explain select * from t1
where (c>60 or c<25) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where (c>60 or c<25) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.c > 60 or t1.c < 25) and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(g)` > 60 or `max(g)` < 25",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((c>60 or c<25) and b>2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
2	3	70	3
select * from t1
where ((c>60 or c<25) and b>2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
2	3	70	3
explain select * from t1
where ((c>60 or c<25) and b>2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((c>60 or c<25) and b>2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.c > 60 or t1.c < 25) and t1.b > 2 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "(`max(g)` > 60 or `max(g)` < 25) and t2.f > 2",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((a<2 or d>2) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
select * from t1
where ((a<2 or d>2) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
explain select * from t1
where ((a<2 or d>2) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((a<2 or d>2) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.a < 2 or t1.d > 2) and t1.b > 3 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "t2.f > 3",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# using view in subquery definition : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where c>20 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
a	b	c	d
3	2	23	1
select * from t1
where c>20 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
a	b	c	d
3	2	23	1
explain select * from t1
where c>20 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t3	ALL	NULL	NULL	NULL	NULL	8	Using where; Using temporary
explain format=json select * from t1
where c>20 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.c > 20 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["x", "max(y)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(y)` > 20",
          "temporary_table": {
            "table": {
              "table_name": "t3",
              "access_type": "ALL",
              "rows": 8,
              "filtered": 100,
              "attached_condition": "t3.x > 1 and t3.x <= 3"
            }
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1,v1
where c>20 and c=y and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d	x	y
3	2	23	1	3	23
select * from t1,v1
where c>20 and c=y and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d	x	y
3	2	23	1	3	23
explain select * from t1,v1
where c>20 and c=y and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where; Using join buffer (flat, BNL join)
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t3.y	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1,v1
where c>20 and c=y and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t3",
      "access_type": "ALL",
      "rows": 8,
      "filtered": 100,
      "attached_condition": "t3.y > 20 and t3.x <= 3 and t3.y is not null"
    },
    "block-nl-join": {
      "table": {
        "table_name": "t1",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "t1.c = t3.y and t1.a is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t3.y"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(g)` > 20",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where a<2 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
1	2	40	2
select * from t1
where a<2 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
1	2	40	2
explain select * from t1
where a<2 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where a<2 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.a < 2 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e < 2"
            }
          }
        }
      }
    }
  }
}
# extracted and formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where a>2 and a<5 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
3	2	23	1
select * from t1
where a>2 and a<5 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
3	2	23	1
explain select * from t1
where a>2 and a<5 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where a>2 and a<5 and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.a > 2 and t1.a < 5 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e > 2 and t2.e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where (a<2 or a>=4) and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
4	2	24	4
1	2	40	2
select * from t1
where (a<2 or a>=4) and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
4	2	24	4
1	2	40	2
explain select * from t1
where (a<2 or a>=4) and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where (a<2 or a>=4) and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.a < 2 or t1.a >= 4) and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and (t2.e < 2 or t2.e >= 4)"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
a	b	c	d
1	4	35	3
select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
a	b	c	d
1	4	35	3
explain select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.a < 2 or t1.a = 5 and t1.b = 5 and t1.c = 5) and t1.b > 3 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and (t2.e < 2 or t2.e = 5) and t2.f > 3"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
a	b	c	d
1	4	35	3
select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
a	b	c	d
1	4	35	3
explain select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((a<2 or a=5) and b>3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e,f
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.a < 2 or t1.a = 5 and t1.b = 5 and t1.c = 5) and t1.b > 3 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and (t2.e < 2 or t2.e = 5) and t2.f > 3"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((b<3 or d>2) and a<2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	2	40	2
select * from t1
where ((b<3 or d>2) and a<2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	2	40	2
explain select * from t1
where ((b<3 or d>2) and a<2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((b<3 or d>2) and a<2) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.b < 3 or t1.d > 2) and t1.a < 2 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e < 2"
            }
          }
        }
      }
    }
  }
}
# using equalities : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where d=1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
select * from t1
where d=1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	3	40	1
explain select * from t1
where d=1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	const,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where
explain format=json select * from t1
where d=1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.a = 1 and t1.d = 1 and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["const", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "table": {
            "table_name": "t2",
            "access_type": "ALL",
            "rows": 12,
            "filtered": 100,
            "attached_condition": "t2.e = 1"
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where d>1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
select * from t1
where d>1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
4	2	24	4
explain select * from t1
where d>1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where d>1 and a=d and
(a,c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.d = t1.a and t1.a > 1 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e > 1"
            }
          }
        }
      }
    }
  }
}
# using view in subquery definition : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where a<3 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
a	b	c	d
2	1	15	4
select * from t1
where a<3 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
a	b	c	d
2	1	15	4
explain select * from t1
where a<3 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.a,test.t1.c	1	
2	MATERIALIZED	t3	ALL	NULL	NULL	NULL	NULL	8	Using where; Using temporary
explain format=json select * from t1
where a<3 and
(a,c) in
(
select x,max(y)
from v1
where x>1
group by x
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.a < 3 and t1.a is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["x", "max(y)"],
      "ref": ["test.t1.a", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t3",
              "access_type": "ALL",
              "rows": 8,
              "filtered": 100,
              "attached_condition": "t3.x > 1 and t3.x <= 3 and t3.x < 3"
            }
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1,v1
where t1.a=v1.x and v1.x<2 and v1.y>30 and
(t1.a,t1.c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d	x	y
1	3	40	1	1	35
1	2	40	2	1	35
select * from t1,v1
where t1.a=v1.x and v1.x<2 and v1.y>30 and
(t1.a,t1.c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d	x	y
1	3	40	1	1	35
1	2	40	2	1	35
explain select * from t1,v1
where t1.a=v1.x and v1.x<2 and v1.y>30 and
(t1.a,t1.c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where; Using join buffer (flat, BNL join)
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t3.x,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1,v1
where t1.a=v1.x and v1.x<2 and v1.y>30 and
(t1.a,t1.c) in
(
select e,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t3",
      "access_type": "ALL",
      "rows": 8,
      "filtered": 100,
      "attached_condition": "t3.x < 2 and t3.y > 30 and t3.x <= 3 and t3.x is not null"
    },
    "block-nl-join": {
      "table": {
        "table_name": "t1",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "t1.a = t3.x and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["e", "max(g)"],
      "ref": ["test.t3.x", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e <= 3"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
# extracted or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((b<3 or b=4) and a<3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	2	40	2
select * from t1
where ((b<3 or b=4) and a<3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
a	b	c	d
1	2	40	2
explain select * from t1
where ((b<3 or b=4) and a<3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.a,test.t1.b,test.t1.c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((b<3 or b=4) and a<3) and
(a,b,c) in
(
select e,f,max(g)
from t2
where e<5
group by e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.b < 3 or t1.a = 4 and t1.b = 4 and t1.c = 4) and t1.a < 3 and t1.a is not null and t1.b is not null and t1.c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["e", "f", "max(g)"],
      "ref": ["test.t1.a", "test.t1.b", "test.t1.c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "t2.f < 3 or t2.f = 4",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.e < 5 and t2.e < 3"
            }
          }
        }
      }
    }
  }
}
drop table t1,t2,t3;
drop view v1;
